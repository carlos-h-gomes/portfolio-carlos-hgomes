{% set cores = {
  5: "bg-green-100 border-green-400 text-green-900",
  4: "bg-lime-100 border-lime-400 text-lime-900",
  3: "bg-yellow-100 border-yellow-400 text-yellow-900",
  2: "bg-orange-100 border-orange-400 text-orange-900",
  1: "bg-red-100 border-red-400 text-red-900"
} %}

<div class="rounded p-4 border {{ cores.get(c.sentimento, 'bg-gray-100 border-gray-300 text-gray-800') }}">
  <div class="flex justify-between items-start mb-2 text-sm">
    <div>
      <span class="uppercase font-semibold">{{ c.flag }}</span> — 
      {% if c.sentimento == 5 %}Ótimo
      {% elif c.sentimento == 4 %}Bom
      {% elif c.sentimento == 3 %}Neutro
      {% elif c.sentimento == 2 %}Ruim
      {% else %}Péssimo
      {% endif %}
    </div>
    <div class="text-xs text-gray-500">
      {{ c.data | formata_data }}
    </div>
  </div>

  <p class="text-base font-medium text-gray-800 whitespace-pre-line mb-2">
    {{ c.comentario }}
  </p>

  {% if c.representante or c.data_contato %}
    <div class="text-xs text-gray-700 border-l-4 border-gray-300 pl-3 ml-1 py-2 bg-gray-50 rounded">
        👤 <strong>Responsável:</strong> {{ c.autor }}<br>
      {% if c.representante %}
      📞 <strong>Último contato com:</strong> {{ c.representante }}<br>
      {% endif %}
      {% if c.data_contato %}
      {% set partes = c.data_contato.split('-') %}
      📅 <strong>Último contato:</strong> {{ partes[2] }}/{{ partes[1] }}/{{ partes[0] }}
      {% endif %}
    </div>
  {% endif %}

  <div class="flex justify-between items-center text-xs text-gray-500">
    <span>Por {{ c.autor }}</span>

    <div class="flex gap-2">
      {% if is_admin %}
        <form method="POST" action="/comentarios/remover"
              onsubmit="return confirm('Remover este comentário?')">
          <input type="hidden" name="cliente_id" value="{{ cliente.id }}">
          <input type="hidden" name="data" value="{{ c.data }}">
          <button type="submit" class="text-red-600 hover:underline">✖</button>
        </form>
      {% endif %}

      {% if c.autor == user %}
        <details class="mt-2">
          <summary class="text-blue-600 cursor-pointer hover:underline">✏️ Editar comentário</summary>
          <form method="POST" action="/comentarios/editar" class="mt-3 space-y-2 border-t pt-3">
            <input type="hidden" name="cliente_id" value="{{ cliente.id }}">
            <input type="hidden" name="data" value="{{ c.data }}">

            <div>
              <label class="block text-xs font-semibold text-gray-600">Comentário</label>
              <textarea name="comentario" rows="2"
                        class="w-full border rounded px-2 py-1 text-sm">{{ c.comentario }}</textarea>
            </div>

            <div>
              <label class="block text-xs font-semibold text-gray-600">Último contato com</label>
              <input type="text" name="representante" value="{{ c.representante }}"
                     class="w-full border rounded px-2 py-1 text-sm">
            </div>

            <div>
              <label class="block text-xs font-semibold text-gray-600">Data do último contato</label>
              <input type="date" name="data_contato" value="{{ c.data_contato }}"
                     class="w-full border rounded px-2 py-1 text-sm">
            </div>

            <button type="submit"
                    class="bg-blue-600 text-white px-4 py-1 rounded text-sm hover:bg-blue-700">
              💾 Salvar alterações
            </button>
          </form>
        </details>
      {% endif %}

    </div>
  </div>
</div>
