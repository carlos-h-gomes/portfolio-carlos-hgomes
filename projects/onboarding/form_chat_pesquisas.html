{% extends "layout.html" %}
{% block content %}
<h2>Etapa: Pesquisas</h2>

<p><strong>üìå Instru√ß√£o:</strong><br>
Aqui voc√™ poder√° configurar as <strong>pesquisas iniciais</strong> e <strong>pesquisas de satisfa√ß√£o</strong> que ser√£o exibidas no in√≠cio ou no final de um atendimento. Cada departamento pode ter apenas uma pesquisa inicial e uma pesquisa final.</p>

<style>
  .pesquisa-container {
    margin-bottom: 30px;
    padding: 20px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
  }
  .campo-pesquisa {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
    align-items: center;
  }
  .campo-pesquisa input[type="text"], .campo-pesquisa select {
    padding: 6px;
    width: 200px;
  }
  .preview-pesquisa {
    background: #fff;
    border: 1px solid #ccc;
    padding: 15px;
    margin-top: 15px;
    max-width: 500px;
  }
  .estrela {
    color: gold;
    font-size: 20px;
  }
</style>

<form method="post">
  <div class="pesquisa-container">
    <h3>Pesquisa Inicial</h3>
    <p><strong>Descri√ß√£o:</strong> A pesquisa inicial √© um formul√°rio apresentado no in√≠cio do atendimento para obter dados de identifica√ß√£o do cliente, que podem servir de chave para o hist√≥rico do cliente e para consulta em outros relat√≥rios do sistema.<br>
    <strong>Observa√ß√£o:</strong> Caso o canal contratado seja WhatsApp, o uso da pesquisa inicial n√£o √© aplic√°vel.</p>
    <div id="campos-inicial"></div>
    <button type="button" onclick="adicionarCampo('inicial')">+ Adicionar Campo</button>

    <div class="preview-pesquisa" id="preview-inicial">
      <strong>Pesquisa Inicial</strong><br><br>
    </div>
  </div>

  <div class="pesquisa-container">
    <h3>Pesquisa de Satisfa√ß√£o</h3>
    <p><strong>Descri√ß√£o:</strong> A pesquisa final √© um formul√°rio apresentado ao t√©rmino do atendimento para obter informa√ß√µes sobre a satisfa√ß√£o do cliente com o atendimento.<br>
    <strong>Observa√ß√£o:</strong> O envio desta pesquisa via WhatsApp √© realizado com o envio de um link para o usu√°rio final.<br>
    <em>* Para outros m√©todos, consulte a √°rea comercial.</em></p>
    <div id="campos-final"></div>
    <button type="button" onclick="adicionarCampo('final')">+ Adicionar Pergunta</button>

    <div class="preview-pesquisa" id="preview-final">
      <strong>Pesquisa de Satisfa√ß√£o</strong><br><br>
    </div>
  </div>

  <br>
  <button type="submit">Avan√ßar ‚Üí</button>
</form>

<script>
function adicionarCampo(tipo) {
  const container = document.getElementById("campos-" + tipo);
  const preview = document.getElementById("preview-" + tipo);

  const div = document.createElement("div");
  div.className = "campo-pesquisa";

  const inputNome = document.createElement("input");
  inputNome.type = "text";
  inputNome.placeholder = "Nome do Campo";

  const selectTipo = document.createElement("select");
  selectTipo.innerHTML = `
    <option value="texto">Texto</option>
    <option value="multipla">M√∫ltipla Escolha</option>
    <option value="avaliacao">Avalia√ß√£o (Estrelas)</option>
  `;

  const selectObrigatorio = document.createElement("select");
  selectObrigatorio.innerHTML = `
    <option value="sim">Obrigat√≥rio</option>
    <option value="nao">Opcional</option>
  `;

  const inputOpcoes = document.createElement("input");
  inputOpcoes.type = "text";
  inputOpcoes.placeholder = "Op√ß√µes (se m√∫ltipla escolha, separadas por v√≠rgula)";

  const inputChave = document.createElement("input");
  inputChave.type = "text";
  inputChave.placeholder = "Chave (opcional)";

  const botaoConfirmar = document.createElement("button");
  botaoConfirmar.type = "button";
  botaoConfirmar.textContent = "Confirmar";

  const botaoRemover = document.createElement("button");
  botaoRemover.type = "button";
  botaoRemover.textContent = "Remover";
  botaoRemover.style.background = "#c33";
  botaoRemover.style.color = "#fff";
  botaoRemover.onclick = () => div.remove();

  botaoConfirmar.onclick = () => atualizarPreview();

  div.appendChild(inputNome);
  div.appendChild(selectTipo);
  div.appendChild(selectObrigatorio);
  div.appendChild(inputOpcoes);
  div.appendChild(inputChave);
  div.appendChild(botaoConfirmar);
  div.appendChild(botaoRemover);

  container.appendChild(div);

  function atualizarPreview() {
    const campo = document.createElement("div");
    campo.style.marginBottom = "10px";

    const nomeCampo = inputNome.value || "Campo";
    const tipo = selectTipo.value;
    const opcoes = inputOpcoes.value.split(",").map(op => op.trim()).filter(op => op);

    campo.innerHTML = `<label>${nomeCampo}:</label><br>`;

    if (tipo === "texto") {
      campo.innerHTML += `<input disabled><br>`;
    } else if (tipo === "multipla") {
      campo.innerHTML += `<select disabled>${opcoes.map(op => `<option>${op}</option>`).join('')}</select><br>`;
    } else if (tipo === "avaliacao") {
      campo.innerHTML += `<span class="estrela">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</span><br>`;
    }

    preview.appendChild(campo);
  }
}
</script>
{% endblock %}
